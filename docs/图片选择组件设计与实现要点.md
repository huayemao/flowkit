对项目中两个图片选择组件（`ImageUploader` 和 `ImageBatchUploader`）的设计与实现要点总结

---

## 图片选择组件设计与实现要点

### 1. 组件概述

- **ImageUploader**：单张图片上传与预览，适用于如头像、单图场景。
- **ImageBatchUploader**：支持多张图片/文件夹批量上传与预览，适用于批量处理、批量导入等场景。

---

### 2. 交互与体验设计

#### 统一体验
- 初始状态下，上传区域尽可能大（如 `h-96`），内容垂直居中，便于拖拽和点击。
- 支持点击、拖拽、粘贴三种方式上传图片（`ImageBatchUploader` 支持文件夹拖拽）。
- 选中图片后，上传区域只显示图片预览，不再显示 placeholder。
- 预览区有明显的背景、圆角、内边距和边框，与外部区分明显。

#### 操作按钮
- 选中图片后，右上角显示“清空”按钮（用 XIcon 或 Trash 图标，带 Tooltip），可一键清空所有已选图片。
- 批量上传时，顶部左侧用图片图标+数字显示已选图片数量。

#### 预览效果
- 图片预览采用紧凑的 grid 布局，`auto-fill + minmax`，自适应多列，间距适中。
- 图片本身无卡片、无阴影，仅圆角，悬浮时平滑放大并发光，动感现代。
- 文件名在图片下方，超长自动省略。
- 已选中文件的图标使用主题色 `text-muted-foreground`，与整体设计保持一致。
- 文件展示采用水平布局：图标 + 文件名 + 文件大小，结构清晰简洁。

#### 加载与禁用
- 上传/处理时显示 loading 动画，防止重复操作。

---

### 3. 代码实现要点

- 事件处理：`onDragOver`、`onDrop`、`onPaste` 均需 `preventDefault` 和 `stopPropagation`，确保拖拽/粘贴生效。
- 支持多文件/文件夹选择（`webkitdirectory`）。
- 组件参数灵活，支持自定义 accept、maxSize、loading、className 等。
- 预览区与上传区风格统一，便于整体 UI 升级和维护。
- 图标按钮采用 Lucide 图标库，配合 Tooltip 组件提升可用性和美观度。

---

### 4. 可扩展性建议

- 可支持单张删除、拖拽排序等更高级的交互。
- 可扩展为支持多种文件类型、图片压缩、格式转换等功能。

---

# 图片选择组件设计与实现要点

## 组件设计原则

### 1. 用户体验
- 支持拖拽上传
- 支持点击选择
- 支持粘贴上传
- 文件类型和大小验证
- 加载状态显示
- 文件删除功能（右上角图标按钮）

### 2. 技术实现

#### 拖拽功能
- 在 Tauri 应用中，拖拽功能需要配置 `dragDropEnabled: false` 来禁用窗口级别的拖拽
- 这样可以避免与组件内部的拖拽功能冲突
- 配置位置：`src-tauri/tauri.conf.json` 的 `app.windows[0].dragDropEnabled`

```json
{
  "app": {
    "windows": [
      {
        "dragDropEnabled": false
      }
    ]
  }
}
```

#### 文件选择器
- 使用浏览器的原生 `<input type="file">` 元素
- 通过 `ref` 程序化触发文件选择
- 重置 input 值以允许选择相同文件

#### 文件处理
- 支持文件类型验证（扩展名和 MIME 类型）
- 支持文件大小限制
- 支持删除已选择的文件（通过传递 `null` 给 `onChange`）

### 3. 组件接口

```typescript
interface FileUploaderProps {
  value?: File | null
  onChange?: (file: File | null) => void  // 支持删除文件
  loading?: boolean
  className?: string
  accept?: string
  maxSize?: number // 单位：MB
  title?: string
  description?: string
  icon?: React.ReactNode
}
```

### 4. 关键实现细节

#### 拖拽状态管理
```typescript
const handleDragLeave = (e: React.DragEvent) => {
  e.preventDefault()
  e.stopPropagation()
  // 只有当鼠标真正离开拖拽区域时才设置 isDragging 为 false
  if (!e.currentTarget.contains(e.relatedTarget as Node)) {
    setIsDragging(false)
  }
}
```

#### 文件删除功能
```typescript
// 删除按钮 - 右上角图标
<button
  onClick={() => onChange?.(null)}
  disabled={loading}
  className="absolute top-2 right-2 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors disabled:opacity-50"
  title="删除文件"
>
  <Trash2 className="h-4 w-4 text-gray-500 hover:text-red-500" />
</button>
```

#### 文件选择重置
```typescript
const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0]
  if (file) {
    await handleFile(file)
  }
  // 重置 input 值，允许选择相同文件
  e.target.value = ''
}
```

### 5. 注意事项

1. **Tauri 配置**：确保 `dragDropEnabled: false` 以避免拖拽冲突
2. **文件类型验证**：同时检查扩展名和 MIME 类型
3. **状态管理**：正确处理拖拽状态的进入和离开
4. **用户体验**：提供清晰的视觉反馈和操作提示
5. **错误处理**：友好的错误提示和验证失败处理

